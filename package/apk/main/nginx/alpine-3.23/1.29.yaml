# syntax=dhi.io/build:2-alpine3.23

image: dhi.io/pkg-nginx
variant: runtime
tags:
  - 1.29.5-alpine3.23
  - 1.29.5-r1-alpine3.23
platforms:
  - linux/amd64
  - linux/arm64
vars:
  _VERSION: 1.28.2
  COMMIT_SHA: 3c1182b74fcc10cc94bda605e600d689a0bc928f
  DEVELKIT_VERSION: 0.3.3
  DYNAMIC_HEALTHCHECK_VERSION: 1.3.8
  DYNAMIC_UPSTREAM_VERSION: 2.3.4
  HTTP_ACCOUNTING_VERSION: "2.0"
  HTTP_ARRAY_VAR_VERSION: "0.06"
  HTTP_AUTH_JWT_VERSION: 0.9.0
  HTTP_BROTLI_VERSION: 1.0.0rc
  HTTP_CACHE_PURGE_VERSION: 2.5.4
  HTTP_COOKIE_FLAG_VERSION: 1.1.0
  HTTP_DAV_EXT_VERSION: 3.0.0
  HTTP_ECHO_VERSION: "0.63"
  HTTP_ENCRYPTED_SESSION_VERSION: "0.09"
  HTTP_FANCYINDEX_VERSION: 0.5.2
  HTTP_GEOIP2_VERSION: "3.4"
  HTTP_HEADERS_MORE_VERSION: "0.39"
  HTTP_KEYVAL_VERSION: 0.3.0
  HTTP_LOG_ZMQ_VERSION: 1.0.0
  HTTP_LUA_UPSTREAM_VERSION: "0.07"
  HTTP_LUA_VERSION: 0.10.29
  HTTP_NAXSI_VERSION: "1.7"
  HTTP_NCHAN_VERSION: 1.3.7
  HTTP_REDIS2_VERSION: "0.15"
  HTTP_SET_MISC_VERSION: "0.33"
  HTTP_SHIBBOLETH_VERSION: 2.0.2
  HTTP_SLOWFS_CACHE_VERSION: "1.11"
  HTTP_UNTAR_VERSION: "1.1"
  HTTP_UPLOAD_PROGRESS_VERSION: 0.9.4
  HTTP_UPLOAD_VERSION: 2.3.0
  HTTP_UPSTREAM_FAIR_VERSION: 0.1.3
  HTTP_VOD_VERSION: "1.33"
  HTTP_VTS_VERSION: 0.2.4
  HTTP_ZIP_VERSION: 1.3.0
  HTTP_ZSTD_VERSION: 0.1.1
  NJS_VERSION: 0.9.5
  PACKAGE_NAME: main/nginx
  REL: "1"
  RTMP_VERSION: 1.2.2
  SEMVER_MAJOR_MINOR_VERSION: "1.29"
  SEMVER_MAJOR_VERSION: "1"
  SEMVER_VERSION: 1.29.5
  STREAM_GEOIP2_VERSION: "3.4"
  STREAM_KEYVAL_VERSION: 0.3.0
  TESTS_REVISION: d964853731321ed99827916355dff54d983e57c0
  TRAIN: mainline
  VERSION: 1.29.5
contents:
  repositories:
    - https://dhi.io/apk/alpine/v3.23/main
    - https://dl-cdn.alpinelinux.org/alpine/v3.23/main
    - https://dl-cdn.alpinelinux.org/alpine/v3.23/community
  keyring:
    - https://dhi.io/keyring/dhi-apk@docker-0F81AD7700D99184.rsa.pub
  packages:
    - alpine-baselayout-data
  builds:
    - name: abuild
      work-dir: ${source.dir}/aports/main/nginx
      contents:
        packages:
          - gd-dev
          - geoip-dev
          - libxslt-dev
          - linux-headers
          - openssl-dev
          - pcre2-dev
          - perl-dev
          - zlib-dev
          - brotli-dev
          - hiredis-dev
          - jansson-dev
          - libmaxminddb-dev
          - libxml2-dev
          - zeromq-dev
          - zstd-dev
          - luajit-dev
          - gd
          - perl
          - perl-fcgi
          - perl-io-socket-ssl
          - perl-net-ssleay
          - perl-protocol-websocket
          - tzdata
          - uwsgi-python3
        files:
          - url: git+https://github.com/alpinelinux/aports.git#3c1182b74fcc10cc94bda605e600d689a0bc928f
            path: ${source.dir}/aports
            uid: 0
            gid: 0
          - url: https://nginx.org/download/nginx-1.29.5.tar.gz
            path: /var/cache/distfiles/nginx-1.29.5.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/nginx/nginx-tests/archive/d964853731321ed99827916355dff54d983e57c0.tar.gz
            path: /var/cache/distfiles/nginx-tests-d964853731321ed99827916355dff54d983e57c0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/nginx/njs/archive/0.9.5.tar.gz
            path: /var/cache/distfiles/nginx-njs-0.9.5.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/libinjection/libinjection/archive/b9fcaaf9e50e9492807b23ffcc6af46ee1f203b9.tar.gz
            path: /var/cache/distfiles/libinjection-b9fcaaf9e50e9492807b23ffcc6af46ee1f203b9.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/vision5/ngx_devel_kit/archive/v0.3.3.tar.gz
            path: /var/cache/distfiles/ngx_devel_kit-0.3.3.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/ZigzagAK/ngx_dynamic_healthcheck/archive/1.3.8.tar.gz
            path: /var/cache/distfiles/ngx_dynamic_healthcheck-1.3.8.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/ZigzagAK/ngx_dynamic_upstream/archive/2.3.4.tar.gz
            path: /var/cache/distfiles/ngx_dynamic_upstream-2.3.4.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/Lax/traffic-accounting-nginx-module/archive/v2.0.tar.gz
            path: /var/cache/distfiles/traffic-accounting-nginx-module-2.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/array-var-nginx-module/archive/v0.06.tar.gz
            path: /var/cache/distfiles/array-var-nginx-module-0.06.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/kjdev/nginx-auth-jwt/archive/0.9.0.tar.gz
            path: /var/cache/distfiles/nginx-auth-jwt-0.9.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/google/ngx_brotli/archive/v1.0.0rc.tar.gz
            path: /var/cache/distfiles/ngx_brotli-1.0.0rc.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/nginx-modules/ngx_cache_purge/archive/2.5.4.tar.gz
            path: /var/cache/distfiles/ngx_cache_purge-2.5.4.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/AirisX/nginx_cookie_flag_module/archive/v1.1.0.tar.gz
            path: /var/cache/distfiles/nginx_cookie_flag_module-1.1.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/arut/nginx-dav-ext-module/archive/v3.0.0.tar.gz
            path: /var/cache/distfiles/nginx-dav-ext-module-3.0.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/echo-nginx-module/archive/v0.63.tar.gz
            path: /var/cache/distfiles/echo-nginx-module-0.63.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/encrypted-session-nginx-module/archive/v0.09.tar.gz
            path: /var/cache/distfiles/encrypted-session-nginx-module-0.09.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/aperezdc/ngx-fancyindex/archive/v0.5.2.tar.gz
            path: /var/cache/distfiles/ngx-fancyindex-0.5.2.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/leev/ngx_http_geoip2_module/archive/3.4.tar.gz
            path: /var/cache/distfiles/ngx_http_geoip2_module-3.4.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/headers-more-nginx-module/archive/v0.39.tar.gz
            path: /var/cache/distfiles/headers-more-nginx-module-0.39.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/kjdev/nginx-keyval/archive/0.3.0.tar.gz
            path: /var/cache/distfiles/nginx-keyval-0.3.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/danifbento/nginx-log-zmq/archive/v1.0.0.tar.gz
            path: /var/cache/distfiles/nginx-log-zmq-1.0.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/lua-nginx-module/archive/v0.10.29.tar.gz
            path: /var/cache/distfiles/lua-nginx-module-0.10.29.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/lua-upstream-nginx-module/archive/v0.07.tar.gz
            path: /var/cache/distfiles/lua-upstream-nginx-module-0.07.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/wargio/naxsi/archive/1.7.tar.gz
            path: /var/cache/distfiles/naxsi-1.7.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/slact/nchan/archive/v1.3.7.tar.gz
            path: /var/cache/distfiles/nchan-1.3.7.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/redis2-nginx-module/archive/v0.15.tar.gz
            path: /var/cache/distfiles/redis2-nginx-module-0.15.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/openresty/set-misc-nginx-module/archive/v0.33.tar.gz
            path: /var/cache/distfiles/set-misc-nginx-module-0.33.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/nginx-shib/nginx-http-shibboleth/archive/v2.0.2.tar.gz
            path: /var/cache/distfiles/nginx-http-shibboleth-2.0.2.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/dvershinin/ngx_slowfs_cache/archive/1.11.tar.gz
            path: /var/cache/distfiles/ngx_slowfs_cache-1.11.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/ajax16384/ngx_http_untar_module/archive/v1.1.tar.gz
            path: /var/cache/distfiles/ngx_http_untar_module-1.1.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/fdintino/nginx-upload-module/archive/2.3.0.tar.gz
            path: /var/cache/distfiles/nginx-upload-module-2.3.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/masterzen/nginx-upload-progress-module/archive/v0.9.4.tar.gz
            path: /var/cache/distfiles/nginx-upload-progress-module-0.9.4.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/itoffshore/nginx-upstream-fair/archive/0.1.3.tar.gz
            path: /var/cache/distfiles/nginx-upstream-fair-0.1.3.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/kaltura/nginx-vod-module/archive/1.33.tar.gz
            path: /var/cache/distfiles/nginx-vod-module-1.33.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/vozlt/nginx-module-vts/archive/v0.2.4.tar.gz
            path: /var/cache/distfiles/nginx-module-vts-0.2.4.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/evanmiller/mod_zip/archive/1.3.0.tar.gz
            path: /var/cache/distfiles/mod_zip-1.3.0.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/tokers/zstd-nginx-module/archive/0.1.1.tar.gz
            path: /var/cache/distfiles/zstd-nginx-module-0.1.1.tar.gz
            uid: 0
            gid: 0
          - url: https://github.com/arut/nginx-rtmp-module/archive/v1.2.2.tar.gz
            path: /var/cache/distfiles/nginx-rtmp-module-1.2.2.tar.gz
            uid: 0
            gid: 0
      pipeline:
        - uses: abuild/setup@v1
        - uses: abuild/bump@v1
          with:
            rel: 1
            version: 1.29.5
        - uses: abuild/build@v1
          with:
            command: checksum
        - uses: abuild/disable@v1
          with:
            function: check
        - uses: abuild/build@v1
          privileged: true
        - uses: abuild/apk@v1
          work-dir: ${source.dir}/aports/nginx-${NAME}
          with:
            depends: nginx=1.29.5-r1
            description: HTTP and reverse proxy server (mainline version)
            license: BSD-2-Clause
            name: nginx-mainline
            options: '!check !strip'
            rel: 1
            url: https://www.nginx.org/
            version: 1.29.5
        - uses: abuild/build@v1
          work-dir: ${source.dir}/aports/nginx-mainline
os-release:
  name: Docker Hardened Images (Alpine)
  id: alpine
  version-id: "3.23"
  pretty-name: Docker Hardened Images/Alpine Linux v3.23
  home-url: https://docker.com/products/hardened-images/
  bug-report-url: https://docker.com/support/
