# DHI image overrides for kube-prometheus-stack.
# Use tag@digest only; leave sha empty to avoid invalid reference format (e.g. @sha256:sha256:...).
# Security context: non-root user (65532) for pod and container where supported.

crds:
  upgradeJob:
    podSecurityContext:
      runAsUser: 65532
      runAsNonRoot: true
      runAsGroup: 65532
      fsGroup: 65532
    containerSecurityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
    image:
      busybox:
        registry: ${busybox.registry}
        repository: ${busybox.repository}
        tag: ${busybox.tag}@${busybox.digest}
        sha: ""
      kubectl:
        registry: ${kubectl.registry}
        repository: ${kubectl.repository}
        tag: ${kubectl.tag}@${kubectl.digest}
        sha: ""

alertmanager:
  alertmanagerSpec:
    securityContext:
      runAsUser: 65532
      runAsNonRoot: true
      runAsGroup: 65532
      fsGroup: 65532
    image:
      registry: ${alertmanager.registry}
      repository: ${alertmanager.repository}
      tag: ${alertmanager.tag}@${alertmanager.digest}
      sha: ""

prometheusOperator:
  securityContext:
    runAsUser: 65532
    runAsNonRoot: true
    runAsGroup: 65532
    fsGroup: 65532
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
  admissionWebhooks:
    securityContext:
      runAsUser: 65532
      runAsNonRoot: true
      runAsGroup: 65532
      fsGroup: 65532
    containerSecurityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
    image:
      registry: ${prometheus-operator-admission-webhook.registry}
      repository: ${prometheus-operator-admission-webhook.repository}
      tag: ${prometheus-operator-admission-webhook.tag}@${prometheus-operator-admission-webhook.digest}
      sha: ""
    patch:
      securityContext:
        runAsUser: 65532
        runAsNonRoot: true
        runAsGroup: 65532
      image:
        registry: ${kube-webhook-certgen.registry}
        repository: ${kube-webhook-certgen.repository}
        tag: ${kube-webhook-certgen.tag}@${kube-webhook-certgen.digest}
        sha: ""
  image:
    registry: ${prometheus-operator.registry}
    repository: ${prometheus-operator.repository}
    tag: ${prometheus-operator.tag}@${prometheus-operator.digest}
    sha: ""
  prometheusConfigReloader:
    image:
      registry: ${prometheus-config-reloader.registry}
      repository: ${prometheus-config-reloader.repository}
      tag: ${prometheus-config-reloader.tag}@${prometheus-config-reloader.digest}
      sha: ""
  thanosImage:
    registry: ${thanos.registry}
    repository: ${thanos.repository}
    tag: ${thanos.tag}@${thanos.digest}
    sha: ""

prometheus:
  prometheusSpec:
    securityContext:
      runAsUser: 65532
      runAsNonRoot: true
      runAsGroup: 65532
      fsGroup: 65532
    image:
      registry: ${prometheus.registry}
      repository: ${prometheus.repository}
      tag: ${prometheus.tag}@${prometheus.digest}
      sha: ""
